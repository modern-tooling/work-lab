#!/bin/bash
# work-lab devcontainer status for tmux status bar
# ⚡dc = connected and reachable
# ⚠dc = devcontainer exists but not connected
# (nothing) = no devcontainer in project

has_devcontainer=false
dc_connected=false

# check if project has a devcontainer config
if [[ -d /workspaces/project/.devcontainer ]] || \
   [[ -f /workspaces/project/.devcontainer.json ]]; then
  has_devcontainer=true
fi

# check SSH tunnel connectivity
if [[ -f /workspaces/project/.work-lab/ip ]]; then
  dc_ip=$(cat /workspaces/project/.work-lab/ip 2>/dev/null)
  if [[ -n "$dc_ip" ]] && nc -z -w 1 "$dc_ip" 22 2>/dev/null; then
    dc_connected=true
  fi
fi

if $dc_connected; then
  echo "⚡dc"
elif $has_devcontainer; then
  echo "⚠ dc"
fi
