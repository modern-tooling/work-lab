#!/bin/bash
# work-lab project name for tmux status bar
# Gets the actual project folder name from the host (not just "project")
# Icon:  = nf-cod-folder (Nerd Font)

project_name=""

# Method 1: Get from docker container label (most accurate)
if command -v docker &>/dev/null; then
  # Get our container ID from hostname (docker sets hostname to short container ID)
  container_id=$(hostname)
  if [[ ${#container_id} -eq 12 ]]; then
    local_folder=$(docker inspect --format '{{index .Config.Labels "devcontainer.local_folder"}}' "$container_id" 2>/dev/null)
    [[ -n "$local_folder" ]] && project_name=$(basename "$local_folder")
  fi
fi

# Method 2: Get from git remote URL
if [[ -z "$project_name" && -d /workspaces/project/.git ]]; then
  remote_url=$(git -C /workspaces/project config --get remote.origin.url 2>/dev/null)
  [[ -n "$remote_url" ]] && project_name=$(basename "$remote_url" .git)
fi

# Fallback
[[ -z "$project_name" ]] && project_name="project"

# Truncate long names (max 25 chars)
[[ ${#project_name} -gt 25 ]] && project_name="${project_name:0:22}..."

echo " $project_name"
