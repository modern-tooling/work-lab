# work-lab tmux config
# Optimized for AI coding agents (gastown, claude, etc.)

# Enable mouse support
set -g mouse on

# Start window numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# ─────────────────────────────────────────────────────────────────────────────
# Status bar - clean, minimal design inspired by tmux2k
# ─────────────────────────────────────────────────────────────────────────────
# Colors: cyan #50c8dc, sky blue #64a0dc, gold #ffd23c, dim #8c969f
# Design: icons for quick recognition, muted separators, breathing room
# Requires: Nerd Font for icons (fallback gracefully without)

set -g status-style 'bg=#1a1d23 fg=#c8c8c8'
set -g status-position bottom
set -g status-justify left
set -g status-left-length 50
set -g status-right-length 80

# Left: session icon + name (cyan), separator, project with folder icon (white)
# Icons:  (nf-oct-terminal),  (nf-cod-folder) - folder icon in wl-project-name
set -g status-left '#[fg=#50c8dc,bold]  #S #[fg=#3a3f4a]│#[fg=#c8c8c8]#(wl-project-name)#[default]  '

# Right: git (sky blue) · dc status (gold) · time (dim)
# Combined script handles conditional separators (no ` · · ` when dc missing)
# Icons:  (git),  (folder), ⚡ (dc), 󰥔 (time)
set -g status-right '#(wl-status-right)'

# Window tabs: rounded pill style
# Active window gets a subtle pill background, inactive stays minimal
# Powerline rounded chars:  (U+E0B6) and  (U+E0B4)
set -g window-status-format '#[fg=#555555] #I:#W '
set -g window-status-current-format '#[fg=#3a3f4a,bg=default]#[bg=#3a3f4a,fg=#50c8dc]#I#[fg=#8c969f]:#[fg=#c8c8c8]#W#[fg=#3a3f4a,bg=default]'
set -g window-status-separator ''

# Pane borders: subtle
set -g pane-border-style 'fg=#333333'
set -g pane-active-border-style 'fg=#50c8dc'

# Message styling
set -g message-style 'bg=#1a1a1f fg=#50c8dc'

# Refresh status bar every 5 seconds (for git status updates)
set -g status-interval 5

# Large scrollback for reviewing agent output
set -g history-limit 50000

# Reduce escape delay (better for vim users)
set -sg escape-time 10

# True color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Monitor activity in other panes
setw -g monitor-activity on
set -g visual-activity off

# Devcontainer attachment
# prefix + D opens a new window attached to the project's devcontainer (via docker exec)
# prefix + S opens SSH tunnel to devcontainer (requires sshd feature)
# Useful for sidecar mode where the project has its own devcontainer
# The [dc] prefix clearly indicates this window is connected to the devcontainer
bind D new-window -n '[dc] shell' 'dc-attach || read -p "Press Enter to close..."'
bind S new-window -n '[dc] ssh' 'dc-ssh || read -p "Press Enter to close..."'

# Session save/restore
# prefix + W saves current session layout (persists across container rebuilds)
bind W run-shell 'wl-session-save && tmux display-message "Session saved"'

# Source user overrides if present
if-shell "[ -f ~/.config/work-lab/tmux.conf.local ]" "source-file ~/.config/work-lab/tmux.conf.local"
